name: Deploy to VPS

on:
  push:
    branches:
      - main  # Change to your main branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        
      - name: Add SSH private key to agent
        uses: webfactory/ssh-agent@v0.5.3
        with:
          ssh-private-key: ${{ secrets.VPS_SSH_KEY  }}  # Ensure this secret contains the new private key

      - name: Deploy to Server
        env:
          VPS_USER: ${{ secrets.VPS_USER }}
          VPS_HOST: ${{ secrets.VPS_HOST }}
          VPS_PORT: ${{ secrets.VPS_PORT }}
        run: |
          # Add the VPS host key to known hosts to avoid verification failure
          mkdir -p ~/.ssh
          ssh-keyscan -H $VPS_HOST >> ~/.ssh/known_hosts

          # SSH into the VPS and deploy
          #ssh -o StrictHostKeyChecking=no -p $VPS_PORT $VPS_USER@$VPS_HOST "
            # Check if the repo directory exists, otherwise clone it
            #if [ ! -d '/home/$VPS_USER/Geopolitics' ]; then
            #  git clone git@github.com:AlexRuedaPayen/Geopolitics.git /home/$VPS_USER/Geopolitics
            #else
            #  cd /home/$VPS_USER/Geopolitics && git pull origin main
            #fi

            # Set up the environment and restart the service
            #cd /home/$VPS_USER/Geopolitics
            #python3 setup_environment.py
            #sudo systemctl restart geopolitics-dashboard.service
          "
