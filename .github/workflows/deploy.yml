name: Deploy to VPS

on:
    push:
        branches:
            - main

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Deploy over SSH
              uses: appleboy/ssh-action@master
              with:
                host: ${{ secrets.VPS_HOST }}
                username: ${{ secrets.VPS_USER }}
                key: ${{ secrets.VPS_SSH_KEY  }}
                port: ${{ secrets.VPS_PORT }}
                script: |
                    if [ ! -d "/home/${{ secrets.VPS_USER }}/Geopolitics" ]; then
                        git clone git@github.com:your_username/Geopolitics.git /home/${{ secrets.VPS_USER }}/Geopolitics
                    else
                        cd /home/${{ secrets.VPS_USER }}/Geopolitics && git pull
                    fi
                                        
                    cd /home/${{ secrets.VPS_USER }}/Geopolitics

                    # Set up virtual environment and dependencies
                    python3 setup_environment.py

                    # Restart the systemd service
                    systemctl restart geopolitics-dashboard.service