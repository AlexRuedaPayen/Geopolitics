name: Deploy to VPS

on:
    push:
        branches:
            - main

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Deploy over SSH
              uses: appleboy/ssh-action@master
              with:
                host: ${{ secrets.VPS_HOST }}
                username: ${{ secrets.VPS_USER }}
                key: ${{ secrets.VPS_SSH_KEY  }}
                port: ${{ secrets.VPS_PORT }}
                script: |
                    cd /home/axan/Geopolitics || git clone git@github.com:AlexRuedaPayen/Geopolitics.git /home/axan/Geopolitics
                    cd /home/axan/Geopolitics
                    git pull origin main

                    /usr/bin/python3 setup_environment.py
                    systemctl --user restart geopolitics-dashboard.service