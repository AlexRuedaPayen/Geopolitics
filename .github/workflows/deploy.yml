name: Deploy to VPS

on:
    push:
        branches:
            - main

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Deploy over SSH
              uses: appleboy/ssh-action@master
              with:
                host: ${{ secrets.VPS_HOST }}
                username: ${{ secrets.VPS_USER }}
                key: ${{ secrets.VPS_SSH_KEY  }}
                port: ${{ secrets.VPS_PORT }}
                script: |
                    cd /home/axan || exit 1

                    if [ ! -d "Geopolitics" ]; then
                        git clone git@github.com:your-username/Geopolitics.git
                    else
                        cd Geopolitics && git pull
                    fi

                    cd /home/axan/Geopolitics

                    /home/axan/Geopolitics/venv/bin/python setup_environment.py

                    systemctl restart geopolitics-dashboard.service
                     